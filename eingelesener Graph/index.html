<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://d3js.org/d3.v3.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link href="style.css" rel="stylesheet" type="text/css">
    <title>D3 Graph</title>
</head>
<body>
	<div id="load_page">
		<!--Filereader fÃ¼r JSON Datei-->
		<form id="jsonFile" name="jsonFile" enctype="multipart/form-data" method="post">
			<fieldset>
				<h2>Json File</h2>
			  	<div id="dropZone">You can Drop files here <br />
				<input type='file' id='fileinput' onchange="setProgBarToZero(); loadFile(); waitForJsonFinishedParsing()">
			  	</div> <br />

			  	<div id="progress_bar">
					<div id="progress" class="percent">0%</div>
			  	</div> <br/>
			</fieldset>
		  </form>
	</div>

	<div id="graph_page" class="invis">
		<div id='graph' style="position: relative; font-family: Helvetica"></div>
		<div id="top_fixed" style="position: fixed; top: 10px; left: 10px">
			<form autocomplete="off", style="overflow: auto;">
				<div class="autocomplete" style="float: left; margin-right: 10px">
				<input type="text" name="searchClass" id="classInput" placeholder="Class-Path">
				</div>
				<div class="autocomplete" style="float: left; margin-right: 10px">
				<input type="text" name="searchMethod" id="methodInput" placeholder="Method">
				</div>
				<button id="search" onclick="callSearch()">Find</button>
			</form>
			<button id="btn" onclick="open_close()" style="margin-top: 10px">Hide Details</button>
		</div>
	</div>

	<script>
		/*function sumChildNodes(node){
			var count = 0;
			for(var i = 0; i < node.getChildNodes().length; i++){
					if(node.getGeneration() < node.getChildNodes()[i][0].getGeneration()) count += sumChildNodes(node.getChildNodes()[i][0]);
			}
			return count + node.getChildNodes().length;
		}*/
		
		var createdNodes = 0;
		var svgCont = d3.select("#graph")
			.append("svg")
			.attr("width", 20000)
			.attr("height", 20000);
			
		svgCont.append("defs").attr("id", "definitions");
		
		var vis = svgCont.append("foreignObject").attr("width", 20000).attr("height", 20000).attr("position","relative");
		
		var rootNode;	// initialized in jsonPars.js and referenced in node.js
		
		var nodeMap = new Map();
		// "rootNode" is referenced in nodes.js as the actual root-node of the whole graph
		/*let rootNode = new node(0, -1, vis, "Ltmr/Demo.main", ["Ljava/lang/invoke/MethodHandle.invokeExact", "Ltmr/Demo.<init>", "Ljava/lang/invoke/MethodHandles.lookup", "Ljava/lang/invoke/MethodType.methodType", "Ljava/lang/invoke/MethodHandles$Lookup.findConstructor"]);
		rootNode.showNode();
		let child1 = rootNode.addChild(1, 1, "Ltmr/Demo.<init>", ["Ljava/lang/Object.<init>", "Ltmr/Demo.verifyCall"]);
		let child2 = rootNode.addChild(2, 2, "Ljava/lang/invoke/MethodHandles.lookup", []);
		let child3 = rootNode.addChild(3, 3, "Ljava/lang/invoke/MethodType.methodType", []);
		let child4 = rootNode.addChild(4, 4, "Ljava/lang/invoke/MethodHandles$Lookup.findConstructor", []);
		let childchild1 = child1.addChild(5, 1, "Ltmr/Demo.verifyCall", []);*/

	</script>
	<script>
		var i = 0;
		function open_close() {


            if(i===0){
                d3.selectAll(".node_inhalt").classed("invis",true);//style("display","none");
                document.getElementById("btn").innerText = "Show details";
                i++;
			}else{
                d3.selectAll(".node_inhalt").classed("invis",false);//style("display","none");
                document.getElementById("btn").innerText = "Hide details";
                i=0;
			}
            d3.selectAll(".edge").each(function(){
                var id = d3.select(this).attr("id");
                toggleToAbstract(id);
            });
			return;
/*			if (i===0){
				d3.selectAll(".node_inhalt").classed("invis",true);//style("display","none");
				d3.selectAll(".edge").each(function(){
					var id = d3.select(this).attr("id");
					toggleToAbstract(id);
				});
				// d3.selectAll(".node_inhalt").style("visibility","hidden");
				document.getElementById("btn").innerText = "Show details";
				i++;
			}else {

				// d3.selectAll(".node_inhalt").style("visibility","visible");
				d3.selectAll(".node_inhalt").classed("invis",false);
				d3.selectAll(".edge").each(function(){
					var id = d3.select(this).attr("id");
					toggleToDetailed(id);
				});
				document.getElementById("btn").innerText = "Hide details";
				i=0;
			}
			return;*/
		}
	</script>
	<script src="rightclickmenu.js"></script>
	<script src="jsonPars.js"></script>
	<script src="../jsonQ-master/jsonQ.js"></script>
	<script src="search.js"></script>
	<script src="ForceTree.js"></script>
    <script src="Edges.js"></script>
    <script src="nodes.js"></script>
</body>
</html>