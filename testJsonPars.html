<!DOCTYPE html>
<html>

<body>

    <form id="jsonFile" name="jsonFile" enctype="multipart/form-data" method="post">

        <fieldset>
            <h2>Json File</h2>
            <input type='file' id='fileinput'>
            <input type='button' id='btnLoad' value='Load' onclick='loadFile();console.log("started load");'>
            <input type="button" value="show" onclick="show()">
        </fieldset>
    </form>

    <p id="demo"></p>

    <!-- <script src="parsJson.js"></script> -->

    <script>
        var strJson = "";
        var arr = [];
        var setString = function (str){
            strJson += str;
            if(strJson.length >= 100000000){
                arr.push(strJson);
                strJson = "";
            }
        }


        var graphJ;
        function loadFile() {
            if (typeof window.FileReader !== 'function') {
                alert("The file API isn't supported on this browser yet.");
                return;
            }

            input = document.getElementById('fileinput').files[0];
            //graphJ = loadJsonFile(input);
            parseFile(input, setString);
            
        }

        function show() {
            //if (graphJ.isLoaded) {
            //    document.getElementById("demo").innerHTML = graphJ.file.reachableMethods[0].method.declaringClass;
            //} else {
            //    document.getElementById("demo").innerHTML = "Document is not loaded yet.";
            //}
            //let json = JSON.parse(strJson);
            function makeString(){
                arr.forEach(function (a) {
                    console.log(a.slice(-100));
                    //document.getElementById(("demo")).innerHTML += a;


                });
                console.log(strJson.slice(-1000000));
                //document.getElementById("demo").innerHTML += strJson;

            }
            makeString();
        }




        function parseFile(file, callback) {
            var fileSize = file.size;
            var chunkSize = 64 * 1024; // bytes
            var offset = 0;
            var self = this; // we need a reference to the current object
            var chunkReaderBlock = null;

            var readEventHandler = function (evt) {
                if (evt.target.error == null) {
                    offset += evt.target.result.length;
                    callback(evt.target.result); // callback for handling read chunk
                } else {
                    console.log("Read error: " + evt.target.error);
                    return;
                }
                if (offset >= fileSize) {
                    console.log("Done reading file");
                    return;
                }

                // of to the next chunk
                chunkReaderBlock(offset, chunkSize, file);
            }

            chunkReaderBlock = function (_offset, length, _file) {
                var r = new FileReader();
                var blob = _file.slice(_offset, length + _offset);
                r.onload = readEventHandler;
                r.readAsText(blob);
            }

            // now let's start the read with the first block
            chunkReaderBlock(offset, chunkSize, file);
        }

    </script>

</body>

</html>